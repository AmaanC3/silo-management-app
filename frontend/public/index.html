<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Silo Management System</title>
  <style>
    /* Basic styling for silo containers */
    #silo-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 20px;
    }

    .silo {
      border: 2px solid #333;
      border-radius: 8px;
      padding: 15px;
      width: 200px;
      text-align: center;
      cursor: pointer; /* Add cursor to indicate it can be clicked */
      transition: background-color 0.3s ease;
    }

    /* Styling for specific text color states */
    .text-green {
      color: #00cc00; /* Green for normal capacity */
    }
    .text-orange {
      color: #ffa500; /* Orange for moderate levels */
    }
    .text-red {
      color: #ff0000; /* Red for high/critical levels */
    }
    .text-blue {
      color: #0000ff; /* Blue for low temperature */
    }

    /* Lighter background color based on overall silo condition */
    .bg-green {
      background-color: #e0f7e0; /* Lighter green for good conditions */
    }
    .bg-orange {
      background-color: #ffe0b3; /* Lighter orange for moderate conditions */
    }
    .bg-red {
      background-color: #ffcccc; /* Lighter red for critical conditions */
    }

    /* Modal Styles */
    .modal {
      display: none; /* Hidden by default */
      position: fixed;
      z-index: 1; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto; /* Enable scrolling if needed */
      background-color: rgb(0, 0, 0); /* Fallback color */
      background-color: rgba(0, 0, 0, 0.4); /* Black with transparency */
      padding-top: 60px;
    }

    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .historical-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .historical-button {
      padding: 10px;
      border: 1px solid #888;
      background-color: #f0f0f0;
      cursor: pointer;
      border-radius: 5px;
    }

    .historical-button:hover {
      background-color: #ddd;
    }

    .historical-data {
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <h1>Silo Management System</h1>
  <div id="silo-container"></div>

  <!-- Modal for detailed silo data -->
  <div id="silo-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="modal-title"></h2>
      <p><strong>Capacity:</strong> <span id="modal-capacity"></span></p>
      <p><strong>Current Level:</strong> <span id="modal-currentLevel"></span></p>
      <p><strong>Humidity:</strong> <span id="modal-humidity"></span></p>
      <p><strong>Temperature:</strong> <span id="modal-temperature"></span></p>

      <!-- Historical Data Buttons -->
      <div id="historical-buttons" class="historical-buttons"></div>

      <!-- Historical Data Display -->
      <div id="modal-historical" class="historical-data"></div>
    </div>
  </div>
  

  <script>
    // Fetch silo data from the backend API
    fetch('http://localhost:3000/api/silos')
      .then(response => response.json())
      .then(data => {
        const siloContainer = document.getElementById('silo-container');
        siloContainer.innerHTML = ''; // Clear any existing content

        data.forEach(silo => {
          const siloElement = document.createElement('div');
          siloElement.classList.add('silo');
          siloElement.setAttribute('data-id', silo.id); // Store silo id for reference

          // Determine text color classes for capacity
          let capacityClass;
          if (silo.currentLevel >= silo.capacity) {
            capacityClass = 'text-red';
          } else if (silo.currentLevel >= silo.capacity * 0.85) {
            capacityClass = 'text-orange';
          } else {
            capacityClass = 'text-green';
          }

          // Determine text color classes for temperature
          let temperatureClass;
          if (silo.temperature >= 33) {
            temperatureClass = 'text-red';
          } else if (silo.temperature >= 28) {
            temperatureClass = 'text-orange';
          } else if (silo.temperature <= 20) {
            temperatureClass = 'text-blue';
          } else {
            temperatureClass = 'text-green';
          }

          // Determine text color classes for humidity
          let humidityClass;
          if (silo.humidity >= 70 || silo.humidity <= 30) {
            humidityClass = 'text-red';
          } else if (silo.humidity >= 60 || silo.humidity <= 40) {
            humidityClass = 'text-orange';
          } else {
            humidityClass = 'text-green';
          }

          // Determine overall background color class based on all criteria
          let bgColorClass;
          if (capacityClass === 'text-red' && temperatureClass === 'text-red' && humidityClass === 'text-red') {
            bgColorClass = 'bg-red'; // All criteria are in red
          } else if (capacityClass === 'text-orange' || temperatureClass === 'text-orange' || humidityClass === 'text-orange') {
            bgColorClass = 'bg-orange'; // At least one criterion is in orange
          } else {
            bgColorClass = 'bg-green'; // All criteria are good (green)
          }

          // Insert HTML with conditional classes for text colors and background
          siloElement.classList.add(bgColorClass); // Add the background color class

          siloElement.innerHTML = `
            <h3>${silo.name}</h3>
            <p>Capacity: ${silo.capacity}</p>
            <p>Current Level: <span class="${capacityClass}">${silo.currentLevel}</span></p>
            <p>Humidity: <span class="${humidityClass}">${silo.humidity}%</span></p>
            <p>Temperature: <span class="${temperatureClass}">${silo.temperature}°C</span></p>
          `;

          // Add click event listener to show the modal
          siloElement.addEventListener('click', () => showModal(silo));

          siloContainer.appendChild(siloElement);
        });
      })
      .catch(error => {
        console.error("Error fetching silo data:", error);
      });

    // Show the modal with detailed silo information
    function showModal(silo) {
      const modal = document.getElementById("silo-modal");
      const closeBtn = document.querySelector(".close");
      
      document.getElementById("modal-title").innerText = silo.name;
      document.getElementById("modal-capacity").innerText = silo.capacity;
      document.getElementById("modal-currentLevel").innerText = silo.currentLevel;
      document.getElementById("modal-humidity").innerText = silo.humidity + '%';
      document.getElementById("modal-temperature").innerText = silo.temperature + '°C';
      modal.style.display = "block";
      
      // Create historical data buttons dynamically
      const historicalButtons = document.getElementById('historical-buttons');
      historicalButtons.innerHTML = ''; // Clear previous buttons
      silo.historicalData.forEach(record => {
        const button = document.createElement('button');
        button.classList.add('historical-button');
        button.innerText = record.date;
        button.onclick = () => displayHistoricalData(record);
        historicalButtons.appendChild(button);
      });

      // Close the modal when the user clicks on the close button
      closeBtn.onclick = () => {
        modal.style.display = "none";
      }

      // Close the modal if the user clicks outside of it
      window.onclick = (event) => {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      }

      modal.style.display = "block";
    }

    // Display the historical data for a selected record
    function displayHistoricalData(record) {
      const historicalDataDiv = document.getElementById('modal-historical');
      historicalDataDiv.innerHTML = `
        <h3>Historical Data for ${record.date}</h3>
        <p>Temperature: ${record.temperature}°C</p>
        <p>Humidity: ${record.humidity}%</p>
        <p>Capacity: ${record.capacity}</p>
        <p>Level: ${record.level}</p>
      `;
    }
  </script>
</body>
</html>
